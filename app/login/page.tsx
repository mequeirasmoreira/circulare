import Link from "next/link";
import { headers } from "next/headers";
import { createClient } from "@/utils/supabase/server";
import { redirect } from "next/navigation";
import { SubmitButton } from "./submit-button";
import Image from "next/image";

export default function Login({
  searchParams,
}: {
  searchParams: { message: string };
}) {
  const signIn = async (formData: FormData) => {
    "use server";

    const email = formData.get("email") as string;
    const password = formData.get("password") as string;
    const supabase = createClient();

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      return redirect("/login?message=Could not authenticate user");
    }

    return redirect("/app");
  };

  const signUp = async (formData: FormData) => {
    "use server";

    const origin = headers().get("origin");
    const email = formData.get("email") as string;
    const password = formData.get("password") as string;
    const supabase = createClient();

    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: `${origin}/auth/callback`,
      },
    });

    if (error) {
      return redirect("/login?message=Could not authenticate user");
    }

    return redirect("/login?message=Check email to continue sign in process");
  };
  
  return (
    <div className="flex w-full bg-[#222633] "> 
      <div className="w-full flex justify-center items-center h-screen">
        <div>
          <Link
            href="/"
            className="text-white absolute left-8 top-8 py-2 px-4 rounded-md no-underline text-foreground bg-btn-background hover:bg-btn-background-hover flex items-center group text-sm"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="white"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
              className="mr-2 h-4 w-4 transition-transform group-hover:-translate-x-1"
            >
              <polyline points="15 18 9 12 15 6" />
            </svg>{" "}
            Voltar
          </Link>
        </div>
        <span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="555"
            height="155"
            fill="none"
            viewBox="0 0 5194 1451"
          >
            <path
              fill="#172554"
              d="M837.999 1254.05a729.677 729.677 0 00-729.677-729.679s-7.485 70.944 0 134.941c6.033 51.591 0 98.93 0 98.93 273.826 0 495.806 221.98 495.806 495.808h233.871z"
            ></path>
            <path
              fill="#1E40AF"
              fillRule="evenodd"
              d="M782.454 476.187a729.67 729.67 0 0055.543-279.235h-233.87c0 273.826-221.98 495.806-495.807 495.806l-31.938 64.081 31.938 169.79a729.694 729.694 0 00279.236-55.543 729.678 729.678 0 00394.898-394.899z"
              clipRule="evenodd"
            ></path>
            <path
              fill="#172554"
              fillRule="evenodd"
              d="M1318.79 786.521l24.37-93.763c-273.83 0-495.807-221.98-495.807-495.806H613.481a729.67 729.67 0 00213.718 515.959 729.707 729.707 0 00236.721 158.175 729.728 729.728 0 00279.24 55.543l-24.37-140.108z"
              clipRule="evenodd"
            ></path>
            <path
              fill="#1E40AF"
              fillRule="evenodd"
              d="M1223.57 772.761C1023.8 822.237 871.821 992.83 850.04 1202.12c-21.475 29.53-219.135 47.16-234.782 1.07a729.662 729.662 0 01211.943-465.102 729.706 729.706 0 01236.719-158.174 729.718 729.718 0 01124.94-39.043s72.87 50.489 83.36 107.603c9.66 52.562-48.65 124.287-48.65 124.287z"
              clipRule="evenodd"
            ></path>
            <path
              fill="#fff"
              fillRule="evenodd"
              d="M1460.03 720.823a729.441 729.441 0 00-55.48-269.881 729.785 729.785 0 00-158.17-236.724A729.717 729.717 0 00730.417.5 729.676 729.676 0 00.8 720.823H.74c0 1.559.005 3.118.015 4.677-.01 1.559-.015 3.118-.015 4.677H.8a729.7 729.7 0 0055.483 269.883 729.567 729.567 0 00158.174 236.72 729.647 729.647 0 00515.96 213.72 729.646 729.646 0 00515.963-213.72 729.672 729.672 0 00158.17-236.72 729.46 729.46 0 0055.48-269.883h.06c0-1.559 0-3.118-.01-4.677.01-1.559.01-3.118.01-4.677h-.06zM1226.2 725.5c-2.51-271.672-223.52-491.129-495.783-491.129-272.265 0-493.274 219.457-495.785 491.129 2.511 271.672 223.52 491.13 495.785 491.13 272.263 0 493.273-219.458 495.783-491.13z"
              clipRule="evenodd"
            ></path>
            <path
              fill="#fff"
              d="M2146.66 920.38c6.59 0 12.43 2.545 17.52 7.634l47.59 51.638c-26.34 32.628-58.82 57.628-97.44 74.988-38.31 17.36-84.41 26.04-138.3 26.04-48.19 0-91.6-8.23-130.22-24.69-38.31-16.47-71.09-39.37-98.34-68.704-27.24-29.337-48.19-64.361-62.86-105.074-14.37-40.712-21.55-85.166-21.55-133.362 0-48.795 7.78-93.399 23.35-133.812 15.56-40.712 37.42-75.737 65.56-105.073 28.43-29.337 62.26-52.088 101.48-68.253 39.21-16.465 82.62-24.697 130.22-24.697 47.29 0 89.2 7.783 125.72 23.35 36.83 15.566 68.11 35.922 93.85 61.068l-40.41 56.129c-2.4 3.592-5.54 6.736-9.43 9.43-3.59 2.694-8.68 4.041-15.27 4.041-4.49 0-9.13-1.197-13.92-3.592-4.79-2.694-10.03-5.838-15.71-9.43-5.69-3.891-12.28-8.082-19.76-12.573-7.48-4.49-16.17-8.531-26.04-12.124-9.88-3.891-21.41-7.034-34.58-9.429-12.87-2.695-27.84-4.042-44.9-4.042-29.04 0-55.68 5.239-79.93 15.717-23.95 10.178-44.6 25.145-61.97 44.903-17.36 19.458-30.83 43.406-40.41 71.845-9.58 28.139-14.37 60.32-14.37 96.542 0 36.521 5.09 69.001 15.27 97.44 10.48 28.439 24.54 52.387 42.21 71.845 17.66 19.458 38.46 34.426 62.41 44.903 23.95 10.178 49.7 15.267 77.24 15.267 16.46 0 31.28-.898 44.45-2.694 13.47-1.796 25.74-4.64 36.82-8.532 11.38-3.891 22-8.83 31.88-14.818 10.18-6.286 20.21-13.92 30.09-22.9 2.99-2.694 6.13-4.79 9.43-6.287 3.29-1.796 6.73-2.694 10.32-2.694zm245.3-307.587V1073.5H2280.6V612.793h111.36zm15.26-134.261c0 9.58-1.94 18.56-5.83 26.942-3.9 8.382-9.14 15.716-15.72 22.003-6.29 6.286-13.77 11.375-22.45 15.267-8.68 3.592-17.96 5.388-27.84 5.388-9.58 0-18.71-1.796-27.39-5.388-8.39-3.892-15.72-8.981-22.01-15.267-6.28-6.287-11.37-13.621-15.26-22.003-3.6-8.382-5.39-17.362-5.39-26.942 0-9.878 1.79-19.158 5.39-27.84 3.89-8.681 8.98-16.165 15.26-22.451 6.29-6.287 13.62-11.226 22.01-14.818 8.68-3.892 17.81-5.838 27.39-5.838 9.88 0 19.16 1.946 27.84 5.838 8.68 3.592 16.16 8.531 22.45 14.818 6.58 6.286 11.82 13.77 15.72 22.451 3.89 8.682 5.83 17.962 5.83 27.84zm202.43 214.189c14.37-27.541 31.43-49.094 51.19-64.661 19.76-15.866 43.11-23.799 70.05-23.799 21.25 0 38.32 4.64 51.19 13.92l-7.18 83.071c-1.5 5.389-3.75 9.28-6.74 11.675-2.69 2.096-6.44 3.143-11.23 3.143-4.49 0-11.22-.748-20.2-2.245-8.68-1.496-17.21-2.245-25.6-2.245-12.27 0-23.2 1.796-32.78 5.389-9.58 3.592-18.26 8.83-26.04 15.716-7.48 6.585-14.22 14.668-20.21 24.247-5.68 9.58-11.07 20.506-16.16 32.78V1073.5h-110.91V612.793h65.11c11.37 0 19.31 2.096 23.8 6.287 4.49 3.891 7.48 11.076 8.98 21.553l6.73 52.088zm547.28 17.512c-3.29 4.191-6.58 7.484-9.88 9.879-2.99 2.395-7.48 3.592-13.47 3.592-5.69 0-11.22-1.646-16.61-4.939-5.39-3.593-11.83-7.484-19.31-11.675-7.49-4.49-16.47-8.382-26.94-11.675-10.18-3.592-22.9-5.388-38.17-5.388-19.46 0-36.52 3.592-51.19 10.776-14.67 6.886-26.94 16.914-36.82 30.086-9.58 13.171-16.77 29.187-21.55 48.046-4.79 18.56-7.19 39.664-7.19 63.314 0 24.547 2.55 46.4 7.63 65.558 5.39 19.159 13.03 35.324 22.9 48.496 9.88 12.872 21.86 22.751 35.93 29.636 14.07 6.586 29.93 9.879 47.59 9.879 17.67 0 31.89-2.096 42.66-6.287 11.08-4.49 20.36-9.28 27.84-14.369 7.49-5.388 13.92-10.178 19.31-14.369 5.69-4.49 11.98-6.735 18.86-6.735 8.98 0 15.72 3.442 20.21 10.327l31.88 40.415c-12.28 14.37-25.6 26.49-39.97 36.37-14.36 9.58-29.33 17.36-44.9 23.35-15.27 5.69-31.13 9.73-47.6 12.12-16.16 2.4-32.33 3.6-48.49 3.6-28.44 0-55.23-5.24-80.38-15.72-25.14-10.78-47.15-26.34-66.01-46.7-18.86-20.356-33.82-45.202-44.9-74.539-10.78-29.636-16.16-63.314-16.16-101.032 0-33.828 4.79-65.11 14.36-93.848 9.88-29.038 24.25-54.034 43.11-74.989 18.86-21.254 42.21-37.868 70.05-49.842 27.84-11.974 59.87-17.961 96.09-17.961 34.43 0 64.51 5.538 90.26 16.614 26.04 11.076 49.39 26.942 70.05 47.597l-29.19 40.413zm500.15-97.44V1073.5h-67.8c-14.67 0-23.95-6.74-27.84-20.21l-7.63-36.82c-18.86 19.16-39.67 34.73-62.42 46.7-22.75 11.68-49.54 17.51-80.38 17.51-25.14 0-47.44-4.19-66.9-12.57-19.16-8.68-35.33-20.8-48.5-36.37-13.17-15.57-23.2-33.977-30.08-55.231-6.59-21.553-9.88-45.202-9.88-70.947V612.793h110.91v292.769c0 28.139 6.43 49.992 19.31 65.559 13.17 15.267 32.78 22.9 58.82 22.9 19.16 0 37.12-4.191 53.88-12.572 16.77-8.682 32.63-20.506 47.6-35.474V612.793h110.91zm222.23-206.555V1073.5H3768.4V406.238h110.91zm353.88 470.586c-32.03 1.497-58.97 4.341-80.82 8.532-21.86 3.891-39.37 8.98-52.54 15.267-13.17 6.286-22.6 13.62-28.29 22.002-5.69 8.382-8.53 17.513-8.53 27.391 0 19.458 5.69 33.378 17.06 41.76 11.68 8.384 26.79 12.574 45.35 12.574 22.75 0 42.36-4.04 58.83-12.125 16.76-8.382 33.08-20.955 48.94-37.718v-77.683zm-254.15-199.819c52.98-48.496 116.75-72.744 191.29-72.744 26.94 0 51.04 4.491 72.29 13.471 21.25 8.682 39.22 20.955 53.88 36.821 14.67 15.567 25.75 34.276 33.23 56.129 7.79 21.853 11.68 45.801 11.68 71.845V1073.5h-50.29c-10.48 0-18.56-1.5-24.25-4.49-5.69-3.29-10.18-9.73-13.47-19.31l-9.88-33.23c-11.68 10.48-23.05 19.76-34.13 27.84-11.07 7.79-22.6 14.37-34.57 19.76-11.98 5.39-24.85 9.43-38.62 12.12-13.47 3-28.44 4.49-44.9 4.49-19.46 0-37.42-2.54-53.89-7.63-16.46-5.39-30.68-13.32-42.66-23.8-11.97-10.48-21.25-23.5-27.84-39.06-6.58-15.57-9.87-33.681-9.87-54.336 0-11.675 1.94-23.2 5.83-34.576 3.9-11.675 10.18-22.751 18.86-33.228 8.98-10.478 20.51-20.356 34.58-29.636 14.07-9.28 31.28-17.363 51.64-24.248 20.65-6.885 44.6-12.423 71.84-16.614 27.24-4.491 58.38-7.185 93.4-8.083v-26.942c0-30.833-6.58-53.584-19.76-68.253-13.17-14.967-32.18-22.451-57.02-22.451-17.96 0-32.93 2.095-44.91 6.286-11.67 4.191-22 8.981-30.98 14.369-8.98 5.089-17.21 9.729-24.7 13.92-7.18 4.191-15.26 6.287-24.24 6.287-7.79 0-14.37-1.946-19.76-5.838-5.39-4.191-9.73-8.98-13.02-14.369l-19.76-35.473zm571.45 15.716c14.37-27.541 31.43-49.094 51.19-64.661 19.76-15.866 43.1-23.799 70.05-23.799 21.25 0 38.31 4.64 51.19 13.92l-7.19 83.071c-1.49 5.389-3.74 9.28-6.73 11.675-2.7 2.096-6.44 3.143-11.23 3.143-4.49 0-11.23-.748-20.21-2.245-8.68-1.496-17.21-2.245-25.59-2.245-12.27 0-23.2 1.796-32.78 5.389-9.58 3.592-18.26 8.83-26.04 15.716-7.49 6.585-14.22 14.668-20.21 24.247-5.69 9.58-11.08 20.506-16.17 32.78V1073.5h-110.91V612.793h65.11c11.38 0 19.31 2.096 23.8 6.287 4.49 3.891 7.49 11.076 8.98 21.553l6.74 52.088zm514.05 97.44c0-14.369-2.1-27.84-6.29-40.413-3.89-12.872-9.88-24.098-17.96-33.678-8.08-9.579-18.41-17.063-30.98-22.451-12.28-5.688-26.64-8.532-43.11-8.532-32.03 0-57.33 9.131-75.89 27.391-18.26 18.261-29.93 44.155-35.02 77.683h209.25zm-211.5 66.906c1.8 23.649 5.99 44.154 12.58 61.517 6.58 17.063 15.26 31.283 26.04 42.658 10.78 11.076 23.5 19.458 38.17 25.146 14.97 5.388 31.43 8.082 49.39 8.082s33.38-2.095 46.25-6.286c13.17-4.191 24.55-8.831 34.13-13.92 9.88-5.089 18.41-9.729 25.59-13.92 7.49-4.191 14.67-6.286 21.56-6.286 9.28 0 16.16 3.442 20.65 10.327l31.88 40.415c-12.27 14.37-26.04 26.49-41.31 36.37-15.26 9.58-31.28 17.36-48.04 23.35a266.161 266.161 0 01-50.74 12.12c-17.07 2.4-33.68 3.6-49.85 3.6-32.03 0-61.81-5.24-89.35-15.72-27.54-10.78-51.49-26.49-71.85-47.15-20.35-20.954-36.37-46.698-48.04-77.232-11.68-30.834-17.52-66.457-17.52-106.87 0-31.432 5.09-60.919 15.27-88.459 10.18-27.84 24.7-51.939 43.56-72.295 19.15-20.655 42.35-36.97 69.6-48.944 27.54-11.974 58.52-17.961 92.95-17.961 29.03 0 55.83 4.64 80.37 13.92 24.55 9.28 45.65 22.9 63.32 40.861 17.66 17.662 31.43 39.515 41.31 65.559 10.18 25.745 15.26 55.231 15.26 88.46 0 16.763-1.79 28.139-5.38 34.126-3.6 5.688-10.48 8.532-20.66 8.532h-285.14z"
            ></path>
          </svg>
        </span>
        
      </div>
      <div className="w-full h-screen rounded-l-lg bg-white flex flex-col justify-center items-center gap-8">
        <div className="flex flex-col gap-4">
          <div className="flex flex-col gap-2">
            <h4 className="font-bold text-2xl">Bem-vindo(a) ao seu CRM</h4>
            <h4 className="max-w-80 font-bold text-2xl">Faça login para ver as últimas atualizações</h4>
          </div>
          <span className="text-slate-400 text-[14px]">Preencha os campos abaixo para fazer login</span>
        </div>

        <form className="flex flex-col w-80 max-w-80 gap-10">
          <div className="flex flex-col gap-6">
            <div className="flex flex-col gap-3">
              <label className="text-[14px] text-slate-400" htmlFor="email">
                  Email
                </label>
                <input
                  className="text-[14px]w-full border-b-slate-400 border-b-[1px] pb-3 focus:outline-none"
                  name="email"
                  placeholder="you@example.com"
                  required
                  />
            </div>
            <div className="flex flex-col gap-3">
              <label className="text-[14px] text-slate-400" htmlFor="password">
                  Password
                </label>
                <input
                  className="text-[14px]w-full border-b-slate-400 border-b-[1px] pb-3 focus:outline-none"
                  type="password"
                  name="password"
                  placeholder="••••••••"
                  required
                  />
            </div>
          </div>
          <div className="flex justify-between gap-4">
              <SubmitButton
                  formAction={signIn}
                  className="bg-[#222633] hover:bg-[#2f3341] text-white py-[14px] w-full rounded-lg"
                  pendingText="Signing In..."
                  >
                  Sign In
              </SubmitButton>
          </div>
          
            {searchParams?.message && (
              <p className="">
                {searchParams.message}
              </p>
            )}
        </form>
      </div>
    </div>
  );
}
